<div class="bg-neutral-100 text-neutral-600 min-h-screen flex flex-col">
  <!-- Header -->
  <header class="p-4 bg-neutral-100 flex justify-between items-center border-b border-primary-light shadow-md">
    <h1 class="text-lg font-semibold text-primary-dark">Olá, Aline Nink!</h1>
    <button class="relative text-primary-dark">
      <i class="fa-regular fa-bell text-xl"></i>
      <span class="absolute -top-1 -right-2 bg-secondary text-white text-xs rounded-full px-2">3</span>
    </button>
  </header>

  <!-- Gráfico e Informações Complementares -->
  <main class="flex-1 p-4 flex flex-col items-center gap-8 mt-6">
    <div class=" w-full flex flex-col md:flex-row gap-6">
      <!-- Resumo do Financiamento -->
      <div class="bg-white p-6 rounded-lg shadow-[0px_4px_12px_rgb(160,196,255,0.5)] flex-1">
        <!-- Cabeçalho -->
        <div class="flex flex-col md:flex-row md:justify-between md:items-center border-b border-neutral-300 pb-4">
          <h2 class="text-lg font-bold text-neutral-800">Resumo do Financiamento</h2>
        </div>

        <!-- Seção principal -->
        <div class="pb-6 pt-6 mt-4 border-b border-neutral-300">
          <div class="flex flex-col items-center w-[96%] relative">

            <!-- Barra de progresso -->
            <div class="relative w-full h-6 bg-[#E3F2FD] rounded-l-full overflow-hidden shadow-md z-0">

              <!-- Barra de progresso - Parcelas Pagas -->
              <div
                class="absolute left-0 top-0 h-full bg-gradient-to-r from-[#4A6A97] via-[#6C8EBF] to-[#AFCDEA] rounded-l-full transition-all duration-700"
                [style.width]="(prestacoesPagas / totalPrestacoes * 100) + '%'">
              </div>

            </div>

            <!-- Marcador final das parcelas pagas -->
            <div class="absolute top-[22%] transform -translate-y-1/2 w-1 h-8 bg-[#0099CC] z-20"
              [style.left]="(prestacoesPagas / totalPrestacoes * 100) + '%'">
            </div>

            <!-- Ícone do carro sobre o marcador final -->
            <div class="absolute -top-8 w-6 h-6 flex items-center justify-center z-30 animate-moving-car"
              [style.left]="(prestacoesPagas / totalPrestacoes * 100) + '%'" style="transform: translateX(-50%);">
              <i class="absolute left-[0.2rem] fa-solid fa-car-side color-flag text-xl"></i>
            </div>

            <!-- Definição da animação no Tailwind -->
            <style>
              @keyframes movingCar {
                0% {
                  transform: translateX(-50%) translateY(0);
                }

                50% {
                  transform: translateX(-50%) translateY(-2px);
                }

                100% {
                  transform: translateX(-50%) translateY(0);
                }
              }

              .animate-moving-car {
                animation: movingCar 0.5s ease-in-out infinite;
                transition: left 0.7s ease-in-out;
              }
            </style>

            <!-- Marcador final da barra -->
            <div class="absolute top-[22%] transform -translate-y-1/2 right-0 w-1 h-8 bg-[#0099CC] z-20"></div>

            <!-- Ícone da bandeira sobre o marcador final -->
            <div class="absolute -top-8 w-6 h-6 flex items-center justify-center z-30 right-0">
              <i class="color-flag absolute left-[1em] fa-solid fa-flag-checkered text-gray-600 text-xl"></i>
            </div>

            <!-- Label com status das parcelas -->
            <p class="mt-4 text-sm text-center mt-2 text-neutral-700 font-semibold">
              {{ prestacoesPagas }} de {{ totalPrestacoes }} parcelas pagas ({{ (prestacoesPagas / totalPrestacoes *
              100).toFixed(0) }}%)
            </p>
          </div>
        </div>



        <!-- Informações financeiras e do veículo -->
        <div class="grid grid-cols-2 md:grid-cols-3 gap-4 mt-6 text-sm text-neutral-700">
          <div>
            <p class="font-semibold text-neutral-900">Valor Financiado</p>
            <p class="text-neutral-700">{{ totalFinanciado() | customCurrency }}</p>
          </div>
          <div>
            <p class="font-semibold text-neutral-900">Saldo Devedor</p>
            <p class="text-neutral-700">{{ totalEmAberto() | customCurrency }}</p>
          </div>
          <div>
            <p class="font-semibold text-neutral-900">Valor em Atraso</p>
            <p class="text-neutral-700">{{ totalAtraso() | customCurrency }}</p>
          </div>
          <div>
            <p class="font-semibold text-neutral-900">Valor da Prestação</p>
            <p class="text-neutral-700">R$ 1.450,33</p>
          </div>
          <div>
            <p class="font-semibold text-neutral-900">Dia do Débito</p>
            <p class="text-neutral-700">04</p>
          </div>
          <div>
            <p class="font-semibold text-neutral-900">Valor do Seguro</p>
            <p class="text-neutral-700">R$ 450,00</p>
          </div>
          <div>
            <p class="font-semibold text-neutral-900">Custo Efetivo Total</p>
            <p class="text-neutral-700">2,3% a.m.</p>
            <p class="text-neutral-700">31,33% a.a.</p>
          </div>
          <div>
            <p class="font-semibold text-neutral-900">Taxa de Juros</p>
            <p class="text-neutral-700">2,24% a.m.</p>
            <p class="text-neutral-700">30,4% a.a.</p>
          </div>

          <!-- Informações do veículo -->
          <div class="col-span-2 md:col-span-3 border-t border-neutral-300 pt-4">
            <p class="font-semibold text-neutral-900">Veículo Financiado</p>
          </div>
          <div>
            <p class="font-semibold text-neutral-900">Modelo</p>
            <p class="text-neutral-700">Toyota Corolla XEi 2022</p>
          </div>
          <div>
            <p class="font-semibold text-neutral-900">Placa</p>
            <p class="text-neutral-700">ABC-1234</p>
          </div>
          <div>
            <p class="font-semibold text-neutral-900">Ano de Fabricação</p>
            <p class="text-neutral-700">2014</p>
          </div>
          <div>
            <p class="font-semibold text-neutral-900">Renavan</p>
            <p class="text-neutral-700">0100200300500</p>
          </div>
          <div>
            <p class="font-semibold text-neutral-900">Chassi</p>
            <p class="text-neutral-700">9BWZZZ377VT004251</p>
          </div>
          <div>
            <p class="font-semibold text-neutral-900">Seguro</p>
            <p class="text-neutral-700">Seguro Auto S.A</p>
          </div>
        </div>
      </div>

      <!-- Cards de Ação -->
      <div class="hidden md:flex flex-col gap-4 w-80">
        <div class="w-full min-w-full">
          <div class="bg-white p-4 rounded-lg shadow-[0px_4px_12px_rgb(160,196,255,0.5)] border border-neutral-300">
            <div class="flex flex-col">
              <i class="fa-solid fa-file-invoice text-primary text-3xl mb-2"></i>
              <p class="text-lg font-bold text-neutral-800">Pagar Prestação</p>
              <p class="text-sm text-neutral-600 mt-2">
                Gere um boleto para pagar sua prestação deste mês, visualize parcelas em atraso e acompanhe suas
                prestações.
              </p>
              <div class="border-t border-neutral-300 my-3"></div>
              <a routerLink="/gerar-boleto"
                class="text-primary font-bold text-sm flex items-center gap-1 hover:underline">
                Emitir Boleto <i class="fa-solid fa-chevron-right"></i>
              </a>
            </div>
          </div>
        </div>

        <div class="w-full min-w-full">
          <div class="bg-white p-4 rounded-lg shadow-[0px_4px_12px_rgb(160,196,255,0.5)] border border-neutral-300">
            <div class="flex flex-col">
              <i class="fa-solid fa-forward text-secondary text-3xl mb-2"></i>
              <p class="text-lg font-bold text-neutral-800">Adiantar Prestação</p>
              <p class="text-sm text-neutral-600 mt-2">Pague antecipadamente prestação futuras e economize juros.</p>
              <div class="border-t border-neutral-300 my-3"></div>
              <a routerLink="/adiantar-parcelas"
                class="text-secondary font-bold text-sm flex items-center gap-1 hover:underline">
                Adiantar Agora <i class="fa-solid fa-chevron-right"></i>
              </a>
            </div>
          </div>
        </div>

        <div class="w-full min-w-full">
          <div class="bg-white p-4 rounded-lg shadow-[0px_4px_12px_rgb(160,196,255,0.5)] border border-neutral-300">
            <div class="flex flex-col">
              <i class="fa-solid fa-check text-primary-dark text-3xl mb-2"></i>
              <p class="text-lg font-bold text-neutral-800">Quitar Contrato</p>
              <p class="text-sm text-neutral-600 mt-2">Realize o pagamento completo do saldo devedor com desconto
                especial.</p>
              <div class="border-t border-neutral-300 my-3"></div>
              <a routerLink="/quitar-contrato"
                class="text-primary-dark font-bold text-sm flex items-center gap-1 hover:underline">
                Quitar Agora <i class="fa-solid fa-chevron-right"></i>
              </a>
            </div>
          </div>
        </div>
      </div>

    </div>

    <!-- Carrossel Mobile -->
    <div class="relative min-w-full w-full mt-6 md:hidden overflow-hidden">
      <div class="flex transition-transform duration-500 ease-in-out" id="carousel">
        <!-- Card 1 -->
        <div class="w-full min-w-full">
          <div class="bg-white p-4 rounded-lg shadow-[0px_4px_12px_rgb(160,196,255,0.5)] border border-neutral-300">
            <div class="flex flex-col">
              <i class="fa-solid fa-file-invoice text-primary text-3xl mb-2"></i>
              <p class="text-lg font-bold text-neutral-800">Pagar Prestação</p>
              <p class="text-sm text-neutral-600 mt-2">
                Gere um boleto para pagar sua prestação deste mês, visualize parcelas em atraso e acompanhe suas
                prestações.
              </p>
              <div class="border-t border-neutral-300 my-3"></div>
              <a routerLink="/gerar-boleto"
                class="text-primary font-bold text-sm flex items-center gap-1 hover:underline">
                Emitir Boleto <i class="fa-solid fa-chevron-right"></i>
              </a>
            </div>
          </div>
        </div>

        <!-- Card 2 -->
        <div class="w-full min-w-full">
          <div class="bg-white p-4 rounded-lg shadow-[0px_4px_12px_rgb(160,196,255,0.5)] border border-neutral-300">
            <div class="flex flex-col">
              <i class="fa-solid fa-forward text-secondary text-3xl mb-2"></i>
              <p class="text-lg font-bold text-neutral-800">Adiantar Prestação</p>
              <p class="text-sm text-neutral-600 mt-2">Pague antecipadamente prestação futuras e economize juros.</p>
              <div class="border-t border-neutral-300 my-3"></div>
              <a routerLink="/adiantar-parcelas"
                class="text-secondary font-bold text-sm flex items-center gap-1 hover:underline">
                Adiantar Agora <i class="fa-solid fa-chevron-right"></i>
              </a>
            </div>
          </div>
        </div>

        <!-- Card 3 -->
        <div class="w-full min-w-full">
          <div class="bg-white p-4 rounded-lg shadow-[0px_4px_12px_rgb(160,196,255,0.5)] border border-neutral-300">
            <div class="flex flex-col">
              <i class="fa-solid fa-check text-primary-dark text-3xl mb-2"></i>
              <p class="text-lg font-bold text-neutral-800">Quitar Contrato</p>
              <p class="text-sm text-neutral-600 mt-2">Realize o pagamento completo do saldo devedor com desconto
                especial.</p>
              <div class="border-t border-neutral-300 my-3"></div>
              <a routerLink="/quitar-contrato"
                class="text-primary-dark font-bold text-sm flex items-center gap-1 hover:underline">
                Quitar Agora <i class="fa-solid fa-chevron-right"></i>
              </a>
            </div>
          </div>
        </div>
      </div>

      <!-- Indicadores do Carrossel -->
      <div class="flex justify-center items-center mt-4">
        <span *ngFor="let i of [0, 1, 2]" class="w-4 h-4 mx-2 rounded-full cursor-pointer" [ngClass]="{
      'bg-primary': i === currentIndex,
      'bg-neutral-400': i !== currentIndex
    }" (click)="goToSlide(i)">
        </span>
      </div>
    </div>

    <!-- Histórico-->
    <div
      class="w-full bg-white p-6 rounded-lg shadow-[0px_4px_12px_rgb(160,196,255,0.5)] border border-neutral-300 mt-6">
      <h3 class="text-lg font-bold text-primary-dark mb-4">Últimas Prestações</h3>
      <div class="space-y-4">
        <div class="border-t border-neutral-300 my-3"></div>

        <!-- Iterando sobre ultimasPrestacoes -->
        <div *ngFor="let transacao of ultimasPrestacoes()"
          class="cursor-card flex justify-between items-center p-4 bg-white rounded-lg shadow-sm hover:bg-neutral-200 transition-colors">
          <div class="flex items-center gap-4">
            <!-- Ícone -->
            <i class="fa-solid fa-money-bill-wave text-primary-dark text-2xl"></i>

            <div>
              <!-- Data de vencimento formatada -->
              <p class="text-md font-semibold text-neutral-800">{{ transacao.dataVencimento | formatDate }}</p>

              <!-- Valor formatado -->
              <p class="text-sm text-neutral-600">Valor: {{ transacao.valor | customCurrency }}</p>

              <!-- Status com cor dinâmica -->
              <!-- Status com cor dinâmica corrigido -->
              <p class="text-sm">
                Status:
                <span [ngClass]="{
    'text-green-600': transacao.status === 'Pago',
    'text-yellow-600': transacao.status === 'Em Aberto',
    'text-red-600': transacao.status === 'Em Atraso'
  }">
                  {{ transacao.status }}
                </span>
              </p>

            </div>
          </div>

          <!-- Botão para baixar comprovante apenas se o status for Pago -->
          <button (click)="baixarComprovante(transacao.valor, transacao.dataVencimento)"
            *ngIf="transacao.status === 'Pago'"
            class="px-4 py-2 md:px-6 md:py-3 bg-primary-light text-neutral-900 rounded-md hover:bg-primary text-xs md:text-sm flex items-center gap-2 transition-colors w-[120px] md:w-auto justify-center">
            <i class="fas fa-download text-sm md:text-base"></i>
            <span class="hidden sm:inline">Baixar Comprovante</span>
          </button>

        </div>

      </div>

      <!-- Mensagem se não houver prestações -->
      <div *ngIf="ultimasPrestacoes().length === 0" class="text-center text-neutral-600">
        Nenhuma prestação encontrada.
      </div>
    </div>

  </main>
</div>

<!-- Footer -->
<footer class="p-4 bg-neutral-100 flex flex-col items-center border-t border-primary-light shadow-md">
  <p class="text-sm text-primary-dark font-semibold">Desenvolvido por Aline Nink</p>
  <div class="flex gap-4 mt-2">
    <a href="#" class="text-primary-dark hover:text-primary transition-colors">LinkedIn</a> <span
      class="text-secondary">|</span>
    <a href="#" class="text-primary-dark hover:text-primary transition-colors">GitHub</a> <span
      class="text-secondary">|</span>
    <a href="#" class="text-primary-dark hover:text-primary transition-colors">E-mail</a>
  </div>
</footer>